# Docker Compose for testing Hugging Face Spaces deployment locally
# This mimics the Hugging Face Spaces environment

version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile.huggingface
    container_name: dreammaker-huggingface
    ports:
      - "7860:7860"
    environment:
      # Required settings
      - NODE_ENV=production
      - PORT=7860
      - HOST=0.0.0.0

      # Application mode (ONLINE, DEMO, or TEST)
      - VITE_APP_MODE=DEMO

      # API endpoints (will be served from same origin)
      - VITE_API_BASE=/api
      - VITE_WS_BASE=/ws

      # Optional: Add your API keys here for full functionality
      # - COINMARKETCAP_API_KEY=your_key_here
      # - CRYPTOCOMPARE_API_KEY=your_key_here
      # - NEWS_API_KEY=your_key_here
      # - BINANCE_API_KEY=your_key_here
      # - BINANCE_API_SECRET=your_secret_here
      # - KUCOIN_API_KEY=your_key_here
      # - KUCOIN_API_SECRET=your_secret_here
      # - KUCOIN_API_PASSPHRASE=your_passphrase_here

      # Feature flags (disable heavy features for free tier)
      - ENABLE_ML_SERVICE=false
      - ENABLE_REDIS=false
      - ENABLE_TELEGRAM=false
      - ENABLE_REAL_TRADING=false

      # Performance optimization
      - MAX_CONCURRENT_REQUESTS=10
      - RATE_LIMIT_ENABLED=true
      - CACHE_ENABLED=true

    volumes:
      # Persist data and configuration
      - ./data:/app/data
      - ./config:/app/config
      - ./logs:/app/logs

    restart: unless-stopped

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7860/api/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

    # Resource limits (similar to Hugging Face free tier)
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 16G
        reservations:
          cpus: '1'
          memory: 8G
